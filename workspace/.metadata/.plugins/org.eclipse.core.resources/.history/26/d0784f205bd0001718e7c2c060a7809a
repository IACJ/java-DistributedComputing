package com.acj.myServer;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.RandomAccessFile;
import java.net.Socket;
import java.net.SocketException;

public class ServerThread implements Runnable{
	
    InputStream input = null;
    OutputStream output = null;
    Socket sock;
	
	public ServerThread(Socket socket) throws IOException {
		this.sock = socket;
        input = socket.getInputStream();
        output = socket.getOutputStream();
	}
	public void run (){


        // 创建Request对象并解析
        MyRequest request = new MyRequest(input);
        request.parse();
        print("用户请求: "+request.getUri());
        
        // 创建 Response 对象
        MyResponse response = new MyResponse(output);
        response.setRequest(request);
        
        // 处理请求并响应
        if (request.getUri() ==null){
        	print("丢弃空请求");
        }else{
        	
            String a[] = request.getUri().split("\\.");  
            
            if (a.length==2 && a[1].equals("py")){
            	print("执行CGI");
            	response.execCGI();
            }else{
            	print("发送静态资源");
            	response.sendStaticResource();
            }   
        }
        
        // 关闭 socket 对象
        sock.close();
        print("断开了一个连接");
        
	}
    public static void print(String s){
    	System.out.println("[Server-Thread]: "+s);
    }

}
