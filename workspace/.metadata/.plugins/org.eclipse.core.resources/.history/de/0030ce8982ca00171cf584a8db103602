package com.acj.sock;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;

public class ServerThread implements Runnable{
    private static String pwd = "c:/test/";
	MyStreamSocket sock;
	
	public ServerThread(MyStreamSocket myStreamSocket) {
		this.sock = myStreamSocket;
	}
	public void run (){
		 String msg = sock.receiveMessage();
	        print("用户请求文件 : " + msg);
	        
	        try{
				File file = new File(pwd+msg);
				FileInputStream fis = new FileInputStream(file);
				sock.sendMessage("True");
				
				sock.sendMessage(file.getName());
				sock.sendMessage("" + file.length() );
			
				/* 开始传输文件 */
				byte[] sendBytes = new byte[1024];
				int length = 0;
				while((length = fis.read(sendBytes, 0, sendBytes.length)) > 0){
					sock.sendData(sendBytes, 0, length);
				}			
				fis.close();
				print("传输成功.");
	        } catch (FileNotFoundException e) {
			    print("找不到该文件，文件名无效！");
			    sock.sendMessage("False");
			} catch(Exception e){
				e.printStackTrace();
			}
	        
	        finally{
				sock.close();	
		        print("已关闭用户连接");
	        }
	}
    public static void print(String s){
    	System.out.println("[Server-Thread]: "+s);
    }

}
