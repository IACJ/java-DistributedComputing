package com.acj.sock;

import java.io.BufferedReader;
import java.io.DataInputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.InetAddress;
import java.net.Socket;

public class Client {
    
    private static final String SERVER_IP = "127.0.0.1";
    private static final int SERVER_PORT = 2017;
    
    private MyStreamSocket cSock;
    
    public Client(){
    	try {
    		try {	
				cSock = new MyStreamSocket(SERVER_IP, SERVER_PORT);
	
				print("请输入你想请求的文件");
				BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
				cSock.sendMessage(br.readLine());
				
		        String msg = cSock.receiveMessage();
		        if ( "False".equals(msg)){
		        	print("找不到该文件，文件名无效");
		        	return;
		        }else{
		        	print("请等待...");
		        }
		        print(cSock.receiveMessage());
		        
				/**开始接收文件*/
//				DataInputStream dis = new DataInputStream(serverSock.getInputStream());
				//文件名和长度

				FileOutputStream fos = new FileOutputStream(new File("c:/test/out_get.txt"));
				 
				byte[] sendBytes = new byte[1024];
				int transLen = 0;
				
				while(true){
					int read = 0;
					read = cSock.receiveData(sendBytes);

					if(read == -1){
						break;
					}
						
				transLen += read;
				//System.out.println("接收文件进度" + 100 * transLen/fileLength + "%...");
				fos.write(sendBytes, 0, read);
				fos.flush();
//				}
//				print("----接收文件<" + fileName + ">成功-------");
//				dis.close();
//				fos.close();
            	} catch (Exception e) {
            		e.printStackTrace();
            	}finally{
            		sSock.close();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    public static void main(String[] args) throws Exception {
    	print("程序开始");
        new Client();
        print("程序结束");
    }
    public static void print(String s){
    	System.out.println("[Client]: "+s);
    }
}